### 模板引擎

模板引擎（Template Engine）是一个将页面模板和数据结合起来生成 html 的工具。那么我们为什么需要模板引擎？

既然要动态地生成页面，便需要将数据插入到页面中。最直接的方式就是在控制器中拼接HTML字符串，最后返回。例如：

```js

app.get('/', function(req, res, next){
	res.set('Content-Type', 'text/html');
	res.send('<html>'+
             '<head>'+
             '</head>'+
             '<body>' + 
               '现在的日期是：' + new Date() + 
             '</body>'+
             '</html');
});

```

利用模板引擎便可以很方便的帮助我们完成这个拼接的过程

### handlebars

```html
<!-- default.hbs -->
<html>
    <head>
        <title></title>
    </head>
        <body>
        {{date}}
        </body>
</html>

```

然后在控制器中提供数据：

```js

app.get('/', function(req, res, next){
    res.render('default.hbs', {date: new Date()});
});

```

模板中的 {{date}} 指定了这里显示的数据为 date，控制器中的 {date: new Date()} 指定了数据 date 的值为 new Date()

而 res.render 方法则是将数据 {date: new Date()} 渲染到模板 default.hbs，并将得到的HTML返回给客户端。

### ejs

跟上面的 handlebars 很类似，同样指定模板，然后加载数据

```html
<!-- default.ejs -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
    <h1><%= name %></h1>
</body>
</html>

```

```js

// 设置存放模板文件的目录
app.set("views", path.join(__dirname, "views"))

// 设置模版引擎为 ejs
app.set("view engine", "ejs");

// 调用 res.render 函数渲染 ejs 模板
app.get('/', function(req, res, next){
    res.render('default.ejs', {name: req.params.name});
});
// res.render 第一个参数是模板的名字，这里是 users 则会匹配 views/users.ejs
// 第二个参数是传给模板的数据，这里传入 name，则在 ejs 模板中可使用 name


```

ejs 有 3 种常用标签：

1. ```<% code %>```：运行 JavaScript 代码，不输出

2. ```<%= code %>```：显示转义后的 HTML内容

3. ```<%- code %>```：显示原始 HTML 内容

> 注意：<%= code %> 和 <%- code %> 都可以是 JavaScript 表达式生成的字符串，当变量 code 为普通字符串时，两者没有区别。当 code 比如为 ```<h1>hello</h1>``` 这种字符串时，```<%= code %>``` 会原样输出 ```<h1>hello</h1>```，而 ```<%- code %>``` 则会显示 H1 大的 hello 字符串。

下面的例子解释了 ```<% code %>``` 的用法：

Data

```
supplies: ['mop', 'broom', 'duster']
```

Template
```
<ul>
<% for(var i=0; i<supplies.length; i++) {%>
   <li><%= supplies[i] %></li>
<% } %>
</ul>
```

Result
```
<ul>
  <li>mop</li>
  <li>broom</li>
  <li>duster</li>
</ul>
```

更多 ejs 的标签请看 [官方文档](https://www.npmjs.com/package/ejs#tags)


### includes

我们将原来的 ```users.ejs``` 拆成出了 ```header.ejs``` 和 ```footer.ejs```，并在 users.ejs 通过 ejs 内置的 include 方法引入，从而实现了跟以前一个模板文件相同的功能。

拆分模板组件通常有两个好处：

1. 模板可复用，减少重复代码

2. 主模板结构清晰

> 注意：要用 ```<%- include('header') %>``` 而不是 ```<%= include('header') %>```